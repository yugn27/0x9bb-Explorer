var tokenAmountglobal,inputUser=prompt("Enter Ethereum Address:");console.log(inputUser);var contractAddress="0x9bb4404231056B105aFCD2861E6b2F5284de5b97",donationAddress="0x9bb4404231056B105aFCD2861E6b2F5284de5b97",web3Mode=null,walletMode="metamask",currentAddress=inputUser,keystore=null,dividendValue=0,tokenBalance=0,contract=null,buyPrice=0,globalBuyPrice=0,sellPrice=0,ethPrice=0,currency="undefined"==typeof default_currency?"USD":default_currency,ethPriceTimer=null,dataTimer=null,abi=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"tokens",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"customerAddress",type:"address"},{indexed:!1,internalType:"uint256",name:"wrappedBTCReinvested",type:"uint256"},{indexed:!1,internalType:"uint256",name:"tokensMinted",type:"uint256"}],name:"onReinvestment",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"customerAddress",type:"address"},{indexed:!1,internalType:"uint256",name:"incomingWrappedBTC",type:"uint256"},{indexed:!1,internalType:"uint256",name:"tokensMinted",type:"uint256"},{indexed:!0,internalType:"address",name:"referredBy",type:"address"},{indexed:!1,internalType:"bool",name:"isReinvest",type:"bool"}],name:"onTokenPurchase",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"customerAddress",type:"address"},{indexed:!1,internalType:"uint256",name:"tokensBurned",type:"uint256"},{indexed:!1,internalType:"uint256",name:"wrappedBTCEarned",type:"uint256"}],name:"onTokenSell",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"customerAddress",type:"address"},{indexed:!1,internalType:"uint256",name:"wrappedBTCWithdrawn",type:"uint256"}],name:"onWithdraw",type:"event"},{payable:!0,stateMutability:"payable",type:"fallback"},{constant:!0,inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"administrators",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_customerAddress",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_referredBy",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"buy",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"buyPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint256",name:"_wrappedBTCToSpend",type:"uint256"}],name:"calculateTokensReceived",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"uint256",name:"_tokensToSell",type:"uint256"}],name:"calculateWrappedBTCReceived",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{internalType:"address",name:"_customerAddress",type:"address"}],name:"dividendsOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"exit",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{internalType:"bool",name:"_includeReferralBonus",type:"bool"}],name:"myDividends",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"myTokens",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"onlyAmbassadors",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[],name:"reinvest",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{internalType:"uint256",name:"_amountOfTokens",type:"uint256"}],name:"sell",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"sellPrice",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"stakingRequirement",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalWrappedBTCBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{internalType:"address",name:"_toAddress",type:"address"},{internalType:"uint256",name:"_amountOfTokens",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"withdraw",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"}];function copyToClipboard(e){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",e);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=e,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(e){return console.warn("Copy to clipboard failed.",e),!1}finally{document.body.removeChild(t)}}}function updateEthPrice(){clearTimeout(ethPriceTimer),"EPY"===currency?(ethPrice=1/(sellPrice+(buyPrice-sellPrice)/2),btcPrice=1/(sellPrice+(buyPrice-sellPrice)/2),ethPriceTimer=setTimeout(updateEthPrice,1e4)):$.getJSON("https://api.coingecko.com/api/v3/simple/price?ids=ethereum,bitcoin&vs_currencies="+currency,function(e){for(var t in e.ethereum)var n=e.ethereum[t],a=e.bitcoin[t];ethPrice=parseFloat(n+currency.toLowerCase()),btcPrice=parseFloat(a+currency.toLowerCase()),$(".Ehtprice").text(ethPrice+" "+currency),$(".btcprice").text(btcPrice+" "+currency),ethPriceTimer=setTimeout(updateEthPrice,1e4)})}function convertBTCToSatoshi(e){return 1e8*e}function convertSatoshiToBTC(e){return e/1e8}function convertEthToWei(e){return 1e18*e}function convertWeiToEth(e){return e/1e18}function getSeed(){useWallet(function(e){console.log(keystore.getSeed(e))})}function generateWallet(){if(null===keystore||confirm(lang.walletGenConfirmation)){var e=lightwallet.keystore.generateRandomSeed(),t=prompt(lang.enterPassword);lightwallet.keystore.createVault({seedPhrase:e,password:t,hdPathString:"m/44'/60'/0'/0"},function(n,a){if(n)throw n;keystore=a,localStorage.setItem("keystore",keystore.serialize()),keystore.keyFromPassword(t,function(t,n){if(t)throw t;keystore.generateNewAddress(n,1);var a=keystore.getAddresses()[0];$("#wallet-seed").html(e),$("#wallet-address").html(a),$("#seed-dimmer").dimmer("show"),walletMode="web",updateData(contract)})})}}function getPassword(e){$("#password-prompt").modal("show"),$("#confirm-tx").off("click"),$("#confirm-tx").on("click",function(){var t=$("#password").val();$("#password").val(""),$("#password-prompt").modal("hide"),e(t)})}function useWallet(e){getPassword(function(t){keystore.keyFromPassword(t,function(t,n){if(t)throw t;e(n)})})}function loadWallet(){useWallet(function(e){try{keystore.generateNewAddress(e,1),walletMode="web",updateData()}catch(e){console.log(e),alert(lang.incorrectPassword)}})}function recoverWallet(){var e=prompt(lang.enterSeed);if(e){var t=prompt(lang.enterPassword);if(t)try{lightwallet.keystore.createVault({seedPhrase:e,password:t,hdPathString:"m/44'/60'/0'/0"},function(e,n){if(e)throw e;keystore=n,localStorage.setItem("keystore",keystore.serialize()),keystore.keyFromPassword(t,function(e,t){if(e)throw e;keystore.generateNewAddress(t,1),walletMode="web",updateData()})})}catch(e){console.log(e),alert(lang.seedInvalid)}}}function detectWeb3(){$("#metamask-detecting").hasClass("visible")&&$("#metamask-detecting").dimmer("hide"),"undefined"!=typeof web3?(web3js=new Web3(web3.currentProvider),web3Mode="metamask",web3.eth.defaultAccount=inputUser):(web3=new Web3(new Web3.providers.HttpProvider("https://mainnet.infura.io/v3/579b4eddc6e444c7a17bd45aa4f32aea")),web3Mode="direct");var e=localStorage.getItem("keystore");null!==e&&(keystore=lightwallet.keystore.deserialize(e),$("#unlock-wallet-container").show());var t=web3js.eth.contract(abi);contract=t.at(contractAddress),console.log(contract,"contract"),updateData(),attachEvents()}function updateData(){clearTimeout(dataTimer);var e=!1;"metamask"===walletMode?(e=void 0!==web3js.eth.defaultAccount&&null!==web3js.eth.defaultAccount,$("#meta-mask-ui").removeClass("wallet-web").addClass("wallet-mm")):"web"===walletMode&&(e=null!==currentAddress,$("#meta-mask-ui").addClass("wallet-web").removeClass("wallet-mm")),null!==currentAddress?($("#eth-address").html(currentAddress),$("#eth-public-address a.etherscan-link").attr("href","https://etherscan.io/address/"+currentAddress).html(currentAddress)):$("#eth-address").html("Not Set"),e?($("#meta-mask-ui").removeClass("logged-out").addClass("logged-in"),contract.balanceOf(currentAddress,function(e,t){const n=t/1e18*.9999;tokenAmountglobal=n,$(".poh-balance").text(Number(n.toFixed(8)).toLocaleString())}),contract.myDividends(!1,function(e,t){let n=convertSatoshiToBTC(t).toFixed(8),a=(dividendValue-n).toFixed(8),o=convertWeiToEth(t).toFixed(8),i=(dividendValue-o).toFixed(8);$(".poh-div-usd2").text("("+Number((i*btcPrice).toFixed(2)).toLocaleString()+" "+currency+")"),$(".poh-refdiv").text(i+" BTC"),$(".poh-refdiv-btc").text(a+" BTC"),$(".poh-refdiv-usd").text(Number((i*ethPrice).toFixed(2)).toLocaleString()+" "+currency),$(".poh-nonrefdiv").text(o+" BTC"),$(".poh-nonrefdiv-btc").text(n+" BTC"),$(".poh-nonrefdiv-usd").text(Number((convertWeiToEth(t)*ethPrice).toFixed(2)).toLocaleString()+" "+currency)}),contract.myDividends(!0,function(e,t){let n=convertSatoshiToBTC(t).toFixed(8),a=convertWeiToEth(t).toFixed(8);$(".poh-div").text(a+" BTC"),$(".poh-div-btc").text(n+" BTC"),$(".poh-div-usd").text(Number((convertWeiToEth(t)*ethPrice).toFixed(2)).toLocaleString()+" "+currency),dividendValue!=n&&($(".poh-div").fadeTo(100,.3,function(){$(this).fadeTo(250,1)}),dividendValue=n)}),web3js.eth.getBalance(currentAddress,function(e,t){$(".address-balance").text(convertWeiToEth(t).toFixed(6)+" ETH")})):$("#meta-mask-ui").addClass("logged-out").removeClass("logged-in"),contract.buyPrice(function(e,t){let n=convertSatoshiToBTC(t);globalBuyPrice=convertSatoshiToBTC(t);let a=convertSatoshiToBTC(t);$(".poh-buy").text(a.toFixed(8)+" BTC"),$(".poh-buy-btc").text(n.toFixed(4)+" BTC"),$(".poh-buy-usd").text("("+Number((a*btcPrice).toFixed(2)).toLocaleString()+" "+currency+")"),$(".contract-balance-usd2").text("("+Number((sellPricegloble*btcPrice).toFixed(2)).toLocaleString()+" "+currency+")")}),contract.totalSupply(function(e,t){let n=t/1e18;$(".contract-tokens").text(n.toLocaleString())}),contract.sellPrice(function(e,t){let n=convertSatoshiToBTC(t),a=convertSatoshiToBTC(t);$(".poh-sell").text(a.toFixed(8)+" BTC"),$(".poh-sell-btc").text(n.toFixed(4)+" BTC"),$(".poh-sell-usd").text("("+Number((a*btcPrice).toFixed(2)).toLocaleString()+" "+currency+")"),n=Number((n*btcPrice).toFixed(8)).toLocaleString(),$(".poh-value2").text((a*tokenAmountglobal).toFixed(8).toLocaleString()+" BTC");var o=a*tokenAmountglobal;$(".poh-value-usd").text("("+Number((o*btcPrice).toFixed(2)).toLocaleString()+" "+currency+")")}),web3js.eth.getBalance(contract.address,function(e,t){$(".contract-balance").text(convertWeiToEth(t).toFixed(4)),$(".contract-balance-usd").text(Number((convertWeiToEth(t)*ethPrice).toFixed(2)).toLocaleString()+" "+currency)}),dataTimer=setTimeout(function(){updateData()},"metamask"===web3Mode?1e3:5e3)}function transferTokens(e,t){"metamask"===walletMode?contract.myTokens(function(n,a){parseFloat(e)<=parseFloat(a)?contract.transfer(t,e,function(n,a){n?(toastr.warning("An error occured. Please check the logs."),console.log("An error occured",n)):toastr.success("You have successfully transferred "+e.div(1e18).toFixed(4)+" tokens to address "+t)}):$("#transfer-amount").addClass("error").popup({title:lang.invalidInput,content:"You input more tokens then can be transferred!"}).popup("show")}):toastr.warning("Transfer functionality supported only with Metamask or Trust Wallet.")}function attachEvents(){}$(".poh-refdiv").text("0.000000 ETH"),$(".poh-refdiv-btc").text("0.000000 BTC"),$(".poh-refdiv-usd").text(" 0 "+currency),$(".poh-nonrefdiv").text("0.000000 ETH"),$(".poh-nonrefdiv-btc").text("0.000000 BTC"),$(".poh-nonrefdiv-usd").text(" 0 "+currency),$(".poh-div").text("0.000000 ETH"),$(".poh-div-usd").text("0 "+currency),$(".poh-value").text("0.000000 ETH"),$(".poh-value-btc").text("0.000000 BTC"),$(".poh-value-usd").text("0 "+currency),$(".poh-balance").text("0"),String.prototype.format||(String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return void 0!==e[n]?e[n]:t})}),window.addEventListener("load",function(){function e(e,t,n,a){web3js.eth.getTransactionCount(currentAddress,function(o,i){if(o)throw o;web3js.eth.getGasPrice(function(o,r){if(o)throw o;r=Math.max(r/10,1e9);var s={from:currentAddress,to:e,value:"0x"+a.toString(16),gasPrice:"0x"+r.toString(16),gasLimit:"0x"+1e5.toString(16),nonce:i},l=lightwallet.txutils.functionTx(abi,t,n,s);useWallet(function(e){try{var t="0x"+lightwallet.signing.signTx(keystore,e,l,currentAddress)}catch(e){return console.log(e),void alert(lang.incorrectPassword)}web3js.eth.sendRawTransaction(t,function(e,t){if(e)throw alert(e.message.substring(0,e.message.indexOf("\n"))),e;$("#tx-hash").empty().append($('<a target="_blank" href="https://etherscan.io/tx/'+t+'">'+t+"</a>")),$("#tx-confirmation").modal("show")})})})})}function t(e){var t=document.cookie,n=e+"=",a=t.indexOf("; "+n);if(-1==a){if(0!=(a=t.indexOf(n)))return null}else{a+=2;var o=document.cookie.indexOf(";",a);-1==o&&(o=t.length)}return decodeURI(t.substring(a+n.length,o))}function n(n,a){console.log(t("ref")),"metamask"===walletMode?contract.buy(t("ref").split(";")[0],convertBTCToSatoshi(a),function(e,t){console.log(e,t)}):"web"===walletMode&&e(n,"buy",[],convertBTCToSatoshi(a))}setTimeout(detectWeb3,500),$("#close-seed").click(function(){$("#seed-dimmer").hasClass("visible")&&($("#seed-dimmer").dimmer("hide"),$("#wallet-dimmer").dimmer("show"))}),$("#generate-wallet").click(function(){generateWallet()}),$("#unlock-wallet").click(function(){loadWallet()}),$("#recover-wallet").click(function(){recoverWallet()}),$("#buy-tokens").click(function(){let e=$("#purchase-amount").val().trim();(e<=0||!isFinite(e)||""===e)&&$("#purchase-amount").addClass("error").popup({title:lang.invalidInput,content:lang.invalidInputResponse}).popup("show"),n(contractAddress,e)}),$("#send-action").click(function(){var e=$("#send-amount").val().trim();if(e<=0||!isFinite(e)||""===e)$("#send-amount").addClass("error").popup({title:lang.invalidInput,content:lang.invalidInputResponse}).popup("show");else{var t=$("#send-address").val();t.match(/^0x[0-9a-fA-F]{40}$/)?($("#send-amount").removeClass("error").popup("destroy"),$("#send-address").removeClass("error").popup("destroy"),n(t,e)):$("#send-address").addClass("error").popup({title:lang.invalidInput,content:lang.invalidInputResponse}).popup("show")}}),$("#donate-action").click(function(){let t=$("#donate-amount").val().trim();t<=0||!isFinite(t)||""===t?$("#donate-amount").addClass("error").popup({title:lang.invalidInput,content:lang.invalidInputResponse}).popup("show"):($("#donate-amount").removeClass("error").popup("destroy"),function(t){if("metamask"===walletMode){const e={from:currentAddress,to:donationAddress,value:convertBTCToSatoshi(t)};web3js.eth.sendTransaction(e,function(e,t){console.log(e)})}else"web"===walletMode&&e(donationAddress,"buy",[],convertBTCToSatoshi(t))}(t))}),$("#wallet-open").click(function(e){e.preventDefault(),$("#wallet-dimmer").dimmer("show")}),$("#wallet-close").click(function(e){e.preventDefault(),$("#wallet-dimmer").dimmer("hide"),$("#exported-seed").html("").slideUp(),$("#exported-private-key").val("").slideUp()}),$("#donate-open").click(function(e){e.preventDefault(),$("#donate-dimmer").dimmer("show")}),$("#donate-close").click(function(){$("#donate-dimmer").dimmer("hide")}),$("#sell-tokens-btn").click(function(){var t;t=$("#sell-tokens-amount").val(),"metamask"===walletMode?contract.sell(convertEthToWei(t),function(e,t){console.log(e,t)}):"web"===walletMode&&e(contractAddress,"sell",[convertBTCToSatoshi(t)],0)}),$("#reinvest-btn").click(function(){"metamask"===walletMode?contract.reinvest(function(e,t){console.log(e,t)}):"web"===walletMode&&e(contractAddress,"reinvest",[],0)}),$("#withdraw-btn").click(function(){"metamask"===walletMode?contract.withdraw(function(e,t){console.log(e,t)}):"web"===walletMode&&e(contractAddress,"withdraw",[],0)}),$("#sell-tokens-btn-m").click(function(){contract.sell(function(e,t){console.log(e,t)})}),$("#reinvest-btn-m").click(function(){contract.reinvest(function(e,t){console.log(e,t)})}),$("#withdraw-btn-m").click(function(){contract.withdraw(function(e,t){console.log(e,t)})}),$("#currency").val(currency),$("#currency").change(function(){currency=$(this).val(),updateEthPrice()}),updateEthPrice(),$("#password-prompt").modal({closable:!1}),$("#cancel-tx").click(function(){$("#password-prompt").modal("hide")}),$("#password").keyup(function(e){13===(e.keyCode||e.which)&&$("#confirm-tx").click()}),$("#delete-wallet").click(function(e){e.preventDefault(),confirm(lang.deleteWalletConfirmation)&&useWallet(function(e){keystore.isDerivedKeyCorrect(e)?($("#wallet-close").click(),keystore=null,localStorage.removeItem("keystore"),currentAddress=null,updateData()):alert(lang.incorrectPassword)})}),$("#export-private-key").click(function(e){e.preventDefault(),useWallet(function(e){var t=keystore.exportPrivateKey(currentAddress,e);$("#exported-seed").html("").slideUp(),$("#exported-private-key").val("0x"+t).slideDown()})}),$("#export-seed").click(function(e){e.preventDefault(),useWallet(function(e){var t=keystore.getSeed(e);$("#exported-private-key").val("").slideUp(),$("#exported-seed").html(t).slideDown()})}),$("#copy-eth-address").click(function(e){e.preventDefault(),copyToClipboard(currentAddress),$("#copy-eth-address").popup({content:lang.copiedToClip,hoverable:!0}).popup("show")}).on("mouseout",function(){$("#copy-eth-address").popup("destroy")})}),$("#purchase-amount").bind("keypress keyup click",function(e){var t=1e8*$("#purchase-amount").val();t?contract.calculateTokensReceived(t,function(e,t){var n=convertWeiToEth(t);$("#buy-tokens").removeAttr("disabled"),$("#deposit-hint").text("You will get approximately "+n.toFixed(3)+" DGS tokens")}):($("#deposit-hint").text(""),$("#buy-tokens").prop("disabled",!0))}),$("#transfer-tokens-btn").click(function(){let e=$("#transfer-address").val(),t=$("#transfer-amount").val();web3.isAddress(e)?parseFloat(t)?transferTokens(web3.toBigNumber(1e18*t),e):toastr.warning("invalid amount"):toastr.warning("invalid address!")});